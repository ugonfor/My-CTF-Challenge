
File = open("./Reversing_Package","rb")
data = File.read()

#step1
#First Input
#Function Epilogue is norally "Leave Ret" -> \xC9\xC3
key1 = "Go"
main_code = b"\x0F\xE2\x7A\xC2\x46\x6F\x47\x87\x67\x95\xB8\x90\xAF\xC4\xBD\x90\xB8\xE6\x02\x8F\xC4\x12\xA7\x6F\x33\x63\xFF\x6F\x47\x6F\x47\x87\x7A\x93\xB8\x90\xAC\x07\x0F\xE2\x7A\x48\x46\x6F\x47\xD7\x47\x6F\x47\x6F\xAF\x4A\xBD\x90\xB8\x27\xCA\x2A\xA9\x27\xCE\xA9\x0F\xE2\x7A\x20\x46\x6F\x47\xD7\x47\x6F\x47\x6F\xAF\x22\xBD\x90\xB8\x27\xCA\x2A\xA9\x27\xCE\xA8\xAF\x8E\xBE\x90\xB8\x27\xC4\x97\x42\x1B\x40\xD7\x46\x6F\x47\x6F\xAC\x44\xCC\x6A\x3D\x78\x67\x6F\x0F\x0C\x97\x27\xCA\x2A\xA9\x27\xCE\xA9\x0F\xE2\x7A\x6A\xBB\x90\xB8\x87\xB8\x92\xB8\x90\xFF\x6F\x47\x6F\x47\x87\xB1\x94\xB8\x90\xFF\x6F\x47\x6F\x47\x27\xCC\x22\xBF\x0B\x0F\x5C\x4B\x4A\x6F\x6F\x47\x6F\x33\x6A\xAF\xCA\xBE\x90\xB8\xA6\x84"
main_code_patch = b""

for i in range(len(main_code)):
    main_code_patch += (ord(key1[i%2]) ^ (main_code[i])).to_bytes(1,'little')


data_code_1 = data.replace(main_code,main_code_patch)

File_patch = open("./Reversing_Package_patch1","wb")
File_patch.write(data_code_1)
File_patch.close()

#step2
#Second Input
#Function Prologue is norally "push rbp; mov rbp,rsp; sub rsp,size" -> 55 48 89 E5 48 83 EC xx
key2 = "CyKor"
ft_code = b"\x16\x31\xC2\x8A\x3A\xC0\x95\x6B\x0B\x3A\xC8\x7D\x6E\x47\x72\x43\x79\x03\xE6\x37\xBB\x48\x8B\x27\xFF\x7E\xCB\x4F\x6F\x72\xFB\x79\x4B\x6F\x72\xAB\xC9\xB6\x90\x8D\x0B\xF4\x0E\x8F\x3A\xCA\xBF\x03\xE2\x4F\x99\x7D\x4B\x6F\xCA\x43\x79\x4B\x6F\x9A\x9B\x84\xB4\x90\x3A\xCE\x3C\xAB\x27\xFB\x85\x31\xC6\x52\xB7\x47\x79\x4B\xD7\x72\x43\x79\x4B\x87\xF2\xBE\x86\xB4\x27\xFF\x06\x99\x03\xE6\xB5\xAB\x2D\xB6\x90\x8D\x0B\xFA\xB3\x62\x06\x44\xC1\x4A\x6F\x72\x43\x92\x66\xE4\x67\xA6\x63\x6B\x6F\x3A\xCE\x3C\xAB\x27\xFB\x85\x31\xC6\x52\x5D\x43\x79\x4B\xD7\x72\x43\x79\x4B\x87\x02\x42\x79\x4B\xD7\x72\x43\x79\x4B\x87\x69\x43\x79\x4B\xD7\x72\x43\x79\x4B\x27\xF9\x0E\x81\x2F\x27\x41\x4F\x5C\x63\x6F\x72\x43\x0D\x4E\x87\x64\xBE\x86\xB4\xA6\xB1"
ft_code_patch = b""

for i in range(len(ft_code)):
    ft_code_patch += (ord(key2[i%5]) ^ (ft_code[i])).to_bytes(1,'little')


data_code_2 = data_code_1.replace(ft_code,ft_code_patch)

File_patch = open("./Reversing_Package_patch2","wb")
File_patch.write(data_code_2)
File_patch.close()


#step3
#Third Input
#Function Prologue is maybe "push rbp; mov rbp,rsp; sub rsp,size; mov rax, fs:28h" -> 55 48 89 E5 48 83 EC xx 64 48 8B 04 25 28 00 00 00
key3 = "K0R34UNIV_CTF"
ft1_code = b"\x1E\x78\xDB\xD6\x7C\xD6\xA2\x69\x32\x17\xC8\x50\x63\x63\x30\x52\x33\x7C\xDC\x0B\xB1\x67\x9F\x0B\x93\x03\xAB\x30\x52\x33\x34\x1D\x89\x0C\xBE\x5F\x43\x54\x46\x8C\x75\xA2\x33\x34\x55\x4E\x01\xDB\x62\xA4\x57\x46\x4B\x88\x52\x33\x34\x55\xA6\xAC\xAA\xA0\xBC\x1C\xCB\x0E\xD0\x1A\xBA\xF2\x1D\xC3\x74\x59\x5B\x43\x54\xFE\x4B\x30\x52\x33\xDC\x58\xB3\xB6\xA9\x17\xCE\x11\xA6\x03\xB9\x94\x7B\xB9\x68\xB4\x4A\x56\x5F\xFB\x54\x46\x4B\x30\xBA\x86\xC8\xAA\xB1\x01\xDB\x1A\xA3\x1C\xCF\x8C\xD8\xDB\xCF\xCB\xAA\x06\xCA\xAE\x4C\x37\x53\xFE\x4A\x30\x52\x33\xDF\x78\xC5\x5C\x48\x45\x63\x54\x0E\xC6\x75\xB2\x7B\xBD\x93\x06\xC4\x6B\x70\x43\x54\x46\xF3\x30\x52\x33\x34\xBD\xEB\x49\x56\x5F\xFB\x54\x46\x4B\x30\xBA\x28\x34\x55\x4E\xF1\x56\x5F\x43\x54\x0E\xC0\x7D\xAA\x57\x7C\x66\x42\x6C\x7E\x5F\x43\x54\x32\x4E\xD8\x19\xCF\xCB\xAA\x87\x8A"
ft1_code_patch = b""

for i in range(len(ft1_code)):
    ft1_code_patch += (ord(key3[i%13]) ^ (ft1_code[i])).to_bytes(1,'little')


data_code_3 = data_code_2.replace(ft1_code,ft1_code_patch)

File_patch = open("./Reversing_Package_patch3","wb")
File_patch.write(data_code_3)
File_patch.close()


#step4
#Second Input
#Function Prologue is norally "push rbp; mov rbp,rsp; sub rsp,size" -> 55 48 89 E5 48 83 EC xx
key4 = "Congratulation_Guys"
ft2_code = b"\x16\x27\xE7\x82\x3A\xE2\x98\x65\x08\x29\xFF\x6D\x4A\x46\x5F\x47\x75\x31\xFA\x06\x97\x5F\xA7\xCC\x4D\x71\x75\x6C\xDE\x94\x61\x2F\x6E\xB7\xCD\x88\x86\x8C\xCA\x2A\x9E\xA0\x37\x95\x74\x75\x6C\x61\x3C\xE4\x2A\x9E\xE5\x70\x75\x79\x73\x0B\xE6\xA8\x2F\xFF\x5C\xC2\x6C\x4C\x61\xCC\x69\x6F\x6E\x5F\xAF\x46\x79\x73\x43\x27\xE3\x52\xD7\x78\x54\x75\x24\xEC\x49\x2A\x6C\x6E\x5F\xFF\x75\x79\x73\x43\x87\x9A\x9C\x8D\x9E\xCC\x75\x6C\x61\x74\x21\xE4\x23\xA7\x23\x3D\x4A\x7F\x66\x47\x6E\x67\x72\x15\x71\x9D\xA7\x9A\x8B\x96\xA6\xAD"
ft2_code_patch = b""

for i in range(len(ft2_code)):
    ft2_code_patch += (ord(key4[i%19]) ^ (ft2_code[i])).to_bytes(1,'little')


data_code_4 = data_code_3.replace(ft2_code,ft2_code_patch)

File_patch = open("./Reversing_Package_patch4","wb")
File_patch.write(data_code_4)
File_patch.close()

